import{l as e,m as a}from"./index-2de332e8.js";import{_ as l}from"./index-10a66ab6.js";import{_ as s}from"./index-2265487e.js";import{_ as t}from"./index-8d30b2c3.js";import{s as o}from"./index-73d29bc9.js";import{_ as n}from"./index-8b7c86b8.js";import{f as u,D as r,u as d,x as p,g as i,h as m,o as c,c as v,a as f,k as y,z as h,C as x,t as j,F as b,B as _,w as k,p as I,d as w,E as V}from"./index-330ef47a.js";import{u as g}from"./useParse-33def060.js";import{u as C}from"./room-987915ac.js";import{u as B}from"./useUser-fd3d3abe.js";import"./index-6a22476b.js";const U={class:"p-5"},z={class:"p-4 mb-5 shadow"},R={class:"p-4 mb-5 shadow"},T={class:"flex justify-between"},$={class:"pb-4 font-sans text-xl font-bold"},D={class:"mt-2"},E={class:"p-4"},H=f("h3",{class:"py-3 font-sans text-lg font-bold"},"新增",-1),M={class:"flex flex-row-reverse mt-5"},Y=u({__name:"index",setup(u){const{getCurrentUser:Y}=B(),q=C(),{addDoc:F}=g("house_table"),G=r(),{roomTable:K}=d(G),{transformRoomsGoodsInfo:L}=G,N=p(),P=i(""),S=i(""),A=i(""),J=i(""),O=i(!1),Q=i(null),W=[{name:"卧室",type:"BR"},{name:"卫生间",type:"BT"},{name:"阳台",type:"BY"}],X=[{name:"入户门",type:"IM"},{name:"玄关",type:"EH"},{name:"厨房",type:"KT"},{name:"大厅",type:"HL"}],Z=i([]),ee=m((()=>Z.value.filter((e=>"BR"===e.type)).length)),ae=m((()=>Z.value.filter((e=>"BT"===e.type)).length)),le=m((()=>Z.value.filter((e=>"BY"===e.type)).length)),se=m((()=>`2厅${ee.value}房${le.value}阳${ae.value}卫1厨`)),te=e=>Z.value.findIndex((a=>a.name===e.name&&a.type===e.type)),oe=e=>{const a=te(e);-1!==a?Z.value.splice(a,1):Z.value.push(e)},ne=e=>{const{objectId:a,name:l,type:s,zIndex:t}=e;return{objectId:a,name:l,type:s,zIndex:t}},ue=m((()=>{return e=W,a=K.value,e.map((({name:e,type:l})=>{const s=a.filter((e=>e.type===l)).map((e=>ne(e)));return{name:e,type:l,children:s}}));var e,a})),re=()=>{const e=ue.value.find((e=>e.type===A.value)),a=K.value.find((e=>e.type===A.value)),l=ne(a);l.name=J.value,l.objectId="c-"+Math.random().toString(36).substr(2),e&&(e.children.push(l),O.value=!1,J.value="",oe(l))},de=async()=>{if(!P.value)return void o.error("楼盘名称不能为空!");if(!S.value)return void o.error("户型不能为空!");if(!Z.value.length)return void o.error("至少选择一个房间!");const e=X.map((({type:e})=>{const a=K.value.find((a=>a.type===e));return ne(a)})).concat(Z.value),a=Y();try{await F({name:P.value,houseId:S.value,roomsInfo:se.value,rooms:e,createUserName:null==a?void 0:a.username})}catch(s){return void o.error("添加失败!")}o.success("添加成功!");const l=L(e);q.setRooms(l),N.push({path:"/details",query:{houseId:"houseId"}})};return(o,u)=>{const r=s,d=e,p=a,i=l,m=n,g=t;return c(),v(b,null,[f("div",U,[f("div",z,[y(r,{placeholder:"楼盘名称",modelValue:h(P),"onUpdate:modelValue":u[0]||(u[0]=e=>x(P)?P.value=e:null)},null,8,["modelValue"]),y(r,{placeholder:"户型",modelValue:h(S),"onUpdate:modelValue":u[1]||(u[1]=e=>x(S)?S.value=e:null)},null,8,["modelValue"])]),f("div",R,[f("p",null,j(h(se)),1)]),(c(!0),v(b,null,_(h(ue),(e=>(c(),v("div",{class:"p-4 mb-5 shadow",key:e.type},[f("div",T,[f("p",$,j(e.name),1),y(p,{class:"",type:"primary",title:"自定义填写内容",onClick:a=>{return l=e.type,A.value=l,O.value=!0,void V((()=>{null==Q||Q.value.focus()}));var l}},{default:k((()=>[y(d,{name:"plus"})])),_:2},1032,["onClick"])]),f("div",null,[y(m,null,{default:k((()=>[(c(!0),v(b,null,_(e.children,(e=>(c(),I(i,{type:-1!==te(e)?"primary":"default",key:e.id,onClick:a=>oe(e)},{default:k((()=>[w(j(e.name),1)])),_:2},1032,["type","onClick"])))),128))])),_:2},1024)])])))),128)),f("div",D,[y(p,{block:"",type:"primary",onClick:de},{default:k((()=>[w("确认")])),_:1})])]),y(g,{position:"top",show:h(O),"onUpdate:show":u[3]||(u[3]=e=>x(O)?O.value=e:null)},{default:k((()=>[f("div",E,[H,y(r,{variant:"outlined",placeholder:"请输入名称",ref_key:"input",ref:Q,autofocus:"",size:"small",modelValue:h(J),"onUpdate:modelValue":u[2]||(u[2]=e=>x(J)?J.value=e:null)},null,8,["modelValue"]),f("div",M,[y(p,{type:"primary",onClick:re},{default:k((()=>[w("提交")])),_:1})])])])),_:1},8,["show"])],64)}}});export{Y as default};
